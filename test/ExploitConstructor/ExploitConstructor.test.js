const { expect } = require('chai');
const { ethers } = require('hardhat');
const {
  deployedBytecode,
} = require('../../artifacts/contracts/ExpoitConstructor/ExploitConstructor.sol/AlteredContract.json');

describe('Exploit Constructor', function () {
  let contractThatDoesNotDoWhatItLooksLike;

  before(
    "Deploy ContractThatDoesNotDoWhatItLooksLike with AlteredContract's bytecode",
    async function () {
      const bytecode = deployedBytecode;
      const bytecodeLength = (bytecode.length - 2) / 2;

      const AlteredContract = await ethers.getContractFactory(
        'AlteredContract'
      );
      const alteredContract = await AlteredContract.deploy();
      await alteredContract.deployed();

      const ContractThatDoesNotDoWhatItLooksLike =
        await ethers.getContractFactory('ContractThatDoesNotDoWhatItLooksLike');
      contractThatDoesNotDoWhatItLooksLike =
        await ContractThatDoesNotDoWhatItLooksLike.deploy(
          bytecodeLength,
          bytecode
        );
      await contractThatDoesNotDoWhatItLooksLike.deployed();
    }
  );

  it('ContractThatDoesNotDoWhatItLooksLike', async function () {
    expect(await contractThatDoesNotDoWhatItLooksLike.add1(1)).to.equal(3);
  });
});
